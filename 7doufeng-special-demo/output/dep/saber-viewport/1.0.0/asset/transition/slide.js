define("saber-viewport/transition/slide",["require","saber-promise","saber-dom","saber-lang/curry","saber-lang/extend","saber-run","../util","../config","../transition"],function(require){function t(t,e,n,r){var i;Object.keys(d).forEach(function(o){if(i=d[o],i[t])i[t](e,n,r)})}function e(e,n,r){var i=p.viewport,o=e.main,a=n.main,s=document.createElement("div"),u=o.offsetWidth,c={width:2*u+"px"};if(l.setStyles(s,c),s.appendChild(o),r.direction===h.LEFT)s.insertBefore(a,o);else s.appendChild(a);if(l.setStyles(o,{"float":"left",width:u+"px",position:"relative"}),l.setStyles(a,{"float":"left",width:u+"px",position:"relative"}),i.appendChild(s),t("before",e,n,r),r.direction===h.LEFT)c=r.transform?{transform:"translate3d(-"+e.main.offsetWidth+"px, 0, 0)"}:{marginLeft:-e.main.offsetWidth+"px"};else if(r.transform)c.transform="translate3d(0, 0, 0)";return l.setStyles(s,c,!0),s}function n(t,e){var n=[];return Object.keys(t).forEach(function(t){if(t in e)n.push(t)}),n}function r(t,e,r){var i=t.getBar(),o=e.getBar(),a=n(i||{},o||{}),u=[];return a.forEach(function(t){var e={front:i[t],back:o[t]};e.change=e.front.getAttribute("data-name")!==e.back.getAttribute("data-name");var n,a=e.front,c=l.getPosition(a),f=s.getStyle(a,"position");if("fixed"!==f&&"position"!==f)n=document.createElement(a.tagName),n.className=a.className,n.style.cssText+=";"+a.style.cssText+";padding:0;border:0;width:"+a.offsetWidth+"px;height:"+a.offsetHeight+"px";else n=document.createElement("ins"),n.style.display="none";if(e.frontBlock=n,a.parentNode.insertBefore(n,a),r.transform&&"fixed"===s.getStyle(e.back,"position")){var p=e.backBlock=document.createElement("ins");p.style.display="none",e.back.parentNode.insertBefore(p,e.back),document.body.appendChild(e.back)}if(n=a,e.frontCSSBack=n.style.cssText,"fixed"!==f){var h=l.getSize(n);n.style.width=h.width+"px",n.style.height=h.height+"px",n.style.position="absolute",n.style.top=c.top+"px",n.style.left=c.left+"px"}document.body.appendChild(n),!!n.offsetWidth,u.push(e)}),u}function i(e,n,r,i){var o=p.viewport,a=n.main,s=a.parentNode;r.forEach(function(t){var e=t.front,n=t.frontBlock,r=n.parentNode;e.style.cssText+=";"+t.frontCSSBack+";opacity:1",r.insertBefore(e,n),r.removeChild(n)}),l.setStyles(a,{"float":"none",width:"auto",position:"static"}),o.appendChild(a),l.setStyles(e.main,{transition:""}),o.removeChild(s),r.forEach(function(t){if(t.backBlock){var e=t.backBlock;e.parentNode.insertBefore(t.back,e),e.parentNode.removeChild(e)}}),t("after",e,n),i.fulfill()}function o(t,n){var o=n.duration||p.duration,s=n.timing||p.timing,l=n.frontPage,g=n.backPage;n.transform=void 0!==n.transform?n.transform:p.transform,n.direction=n.direction||(g.hasVisited?h.LEFT:h.RIGHT),d=c(n.processor||{},m);var v=e(l,g,n),y=r(l,g,n),b=[];y.forEach(function(t){b.push(f.transition(t.front,{opacity:0},{duration:t.change?o:.1,timing:s,delay:t.change?0:o}))});var w=n.direction===h.LEFT?0:-l.main.offsetWidth,E=n.transform?{transform:"translate3d("+w+"px, 0, 0)"}:{marginLeft:w+"px"},x=f.transition(v,E,{duration:o,timing:s});b.push(x),a.all(b).then(u(i,l,g,y,t))}var a=require("saber-promise"),s=require("saber-dom"),u=require("saber-lang/curry"),c=require("saber-lang/extend"),f=require("saber-run"),l=require("../util"),p=require("../config"),h={LEFT:"left",RIGHT:"right"},d={},m={};return m.fixed={before:function(t,e){var r=t.getFixed(),i=r.length;r=r.concat(e.getFixed());var o=t.getBar(),a=e.getBar(),u=n(o,a),f=c(o,a);Object.keys(f).forEach(function(t){if(u.indexOf(t)<0&&"fixed"===s.getStyle(f[t],"position"))r.push(f[t])}),this.fixedEles=r;var p,h,d,m=this.data=[],g=["top","left","right","bottom","width","height","position"],v=t.main;r.forEach(function(t,n){if(n>=i)v=e.main;p={},g.forEach(function(e){p[e]=t.style[e]||null}),m.push(p),d=s.position(t);for(var r=0,o=2;o>r;r++){if(h=parseInt(s.getStyle(t,"margin-"+g[r]),10),!isNaN(h))d[g[r]]-=h;if(h=parseInt(s.getStyle(v,"margin-"+g[r]),10),!isNaN(h))d[g[r]]-=h}l.setStyles(t,{position:"absolute",top:d.top+"px",left:d.left+"px",width:s.getStyle(t,"width")+"px",height:s.getStyle(t,"height")+"px",bottom:"auto",right:"atuo"})})},after:function(){var t,e=this.data;this.fixedEles.forEach(function(n,r){t=e[r],Object.keys(t).forEach(function(e){n.style[e]=t[e]})})}},require("../transition").register("slide",o),o.RIGHT=h.RIGHT,o.LEFT=h.LEFT,o});