define("saber-widget/Slider",["require","exports","module","saber-lang","saber-dom","hammer","./Widget","./main"],function(require){function t(){this.attrs={direction:{value:"horizon"},animate:{value:!0},auto:{value:!0,repaint:!0},interval:{value:4e3},flex:{value:!1,repaint:!0},index:{value:0},speed:{value:300},switchAt:{value:.5},length:{readOnly:!0,getter:function(){return this.runtime.length||0}}},this.states={stop:!0},a.apply(this,arguments)}function e(t,e,n){if(arguments.length>2)return i.setStyle(t,e,(parseInt(n,10)||0)+"px");else return parseInt(i.getStyle(t,e),10)||0}var n=require("saber-lang"),i=require("saber-dom"),r=require("hammer"),a=require("./Widget");return t.prototype={type:"Slider",initDom:function(){var t=this.get("main"),e=i.query("[data-role=wrapper]",t)||i.children(t)[0];if(e)i.setData(e,"role","wrapper"),i.children(e).forEach(function(t){i.setData(t,"role","item")});this.runtime.wrapper=e},initEvent:function(){var t="horizon"==this.get("direction")?"release touch dragleft dragright swipeleft swiperight":"release touch dragup dragdown swipeup swipedown",e=this.runtime;e.hammer=new r(e.wrapper,{dragLockToAxis:!0}).on(t,e.handler=n.bind(this._handleHammer,this)),this.on("beforedispose",function(){e.hammer.off(t,e.handler)})},repaint:function(t){if(a.prototype.repaint.call(this,t),!t)return void this._resize(!0).enable();if(t.hasOwnProperty("auto"))this[t.auto[1]?"start":"stop"](!0);if(t.hasOwnProperty("flex"))this[t.flex[1]?"enablePlugin":"disablePlugin"]("SliderFlex","flex")},enable:function(){if(this.is("disable")&&this.is("render")){this.start();var t=this.runtime.hammer;if(t)t.enable(!0);if(this.get("flex"))this.enablePlugin("SliderFlex","flex")}return a.prototype.enable.call(this),this},disable:function(){if(!this.is("disable")&&this.is("render")){this.stop();var t=this.runtime.hammer;if(t)t.enable(!1);if(this.get("flex"))this.disablePlugin("SliderFlex")}return a.prototype.disable.call(this),this},_handleHammer:function(t){var e=t.gesture,n=t.type;if("touch"!==n)e.preventDefault();var i=this.runtime,r=i.width,a=i.height,o=this.get("index"),s=this.get("length");switch(n){case"touch":if(i.needResume=!this.is("pause")&&!this.is("stop"),i.needResume)this.pause();break;case"dragright":case"dragleft":var u=this._percent(o),c=100/r*e.deltaX/s;if(0===o&&"right"===e.direction||o===s-1&&"left"===e.direction)c*=.4;this._move(c+u);break;case"dragup":case"dragdown":var u=this._percent(o),c=100/a*e.deltaY/s;if(0===o&&"up"===e.direction||o===s-1&&"down"===e.direction)c*=.4;this._move(c+u);break;case"swipeleft":case"swipeup":if(e.stopDetect(),this.next(),i.needResume)this.resume();break;case"swiperight":case"swipedown":if(e.stopDetect(),this.prev(),i.needResume)this.resume();break;case"release":if("horizon"===this.get("direction"))if(Math.abs(e.deltaX)>r*this.get("switchAt"))this["right"===e.direction?"prev":"next"]();else this.to(o);else if(Math.abs(e.deltaY)>a*this.get("switchAt"))this["down"===e.direction?"prev":"next"]();else this.to(o);if(i.needResume)this.resume()}},_percent:function(t){var e=this.get("length");return t=Math.max(0,Math.min(e-1,t)),-(100/e)*t},_resize:function(t){var n=this.runtime,r=n.width,a=n.height,o=e(this.get("main"),"width"),s=e(this.get("main"),"height");if(!t&&o===r&&s===a)return this;n.width=o,n.height=s;for(var u=i.children(n.wrapper),c=n.length=u.length,l=0;c>l;l++)e(u[l],"width",o),e(u[l],"height",s);if("horizon"===this.get("direction"))e(n.wrapper,"width",o*c);else e(n.wrapper,"height",s*c);return this.emit("resize",r,o),this},_loop:function(t){var e=this.runtime,i=this.get("interval");if(e.timer=clearTimeout(e.timer),!(t||!i||0>i))if(this.get("length")<2)return void this.to(0).pause();else return void(e.timer=setTimeout(n.bind(function(){var t=this.get("index")+1;this.to(t<this.get("length")?t:0),this._loop()},this),i))},_move:function(t,e){var n=this.runtime.wrapper;if(this.get("animate"))i.setStyle(n,"transition","all "+(e||0)+"ms");if("horizon"===this.get("direction"))i.setStyle(n,"transform","translate3d("+t+"%, 0, 0) scale3d(1, 1, 1)");else i.setStyle(n,"transform","translate3d(0, "+t+"%, 0) scale3d(1, 1, 1)");return this},sync:function(){if(this.is("render"))this.pause()._resize(!0)._move(this._percent(this.get("index"))).resume();return this},start:function(t){if(this.is("stop")&&(t||this.get("auto")))this.removeState("stop"),this._loop();return this},stop:function(t){if(!this.is("stop")&&(t||this.get("auto")))this.addState("stop"),this._loop(!0);return this},pause:function(){if(!this.is("pause")&&!this.is("stop"))this.addState("pause"),this._loop(!0);return this},resume:function(){if(this.is("pause"))this.removeState("pause"),this._loop();return this},to:function(t){if(this.is("disable"))return this;var e=this.get("index");if(t=Math.max(0,Math.min(t,this.get("length")-1)),this._move(this._percent(t),this.get("speed")),e!==t)this.set("index",t),this.emit("change",e,t);return this},prev:function(){return this.to(this.get("index")-1)},next:function(){return this.to(this.get("index")+1)}},n.inherits(t,a),require("./main").register(t),t});