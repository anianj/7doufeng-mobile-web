define("saber-widget/Suggestion",["require","saber-lang","saber-dom","saber-ajax","saber-promise","./Widget","./main"],function(require){function e(){this.attrs={source:{value:"http://suggestion.baidu.com/su?json=1"},param:{value:"wd"},jsonp:{value:"cb"},history:{value:!1},confirmClearHistory:{value:!1},autoClose:{value:!0}},this.states={show:!1},o.apply(this,arguments)}function t(e,t){t=t||{},t.key=t.key||"callback";var n=new a,i="S_CB_"+Math.random().toString(12).substr(2),r=document.createElement("script");e=e+"&"+t.key+"="+i,window[i]=function(){return function(e){try{n.resolve(e)}catch(t){n.reject(t)}finally{if(window[i]=null,delete window[i],r)r.parentNode.removeChild(r)}}}(),r.src=e,r.async=!0;var o=document.getElementsByTagName("head")[0]||document.body;return o.appendChild(r),o=null,n.promise()}var n=require("saber-lang"),i=require("saber-dom"),r=require("saber-ajax"),a=require("saber-promise"),o=require("./Widget");return e.prototype={type:"Suggestion",initDom:function(){var e=this,t=e.get("main");if(!e.get("sug")){var n=document.createElement("div");i.setData(n,"role","sug"),t.appendChild(n),e.set("sug",n)}e.get("input")||e.set("input",i.query("[data-role=input]",t));var r=e.get("input");if(r)r.setAttribute("autocomplete","off");e.get("search")||e.set("search",i.query("[data-role=search]",t)),e.get("reset")||e.set("reset",i.query("[data-role=reset]",t))},initEvent:function(){var e=this,t=e.get("input");e.addEvent(t,"input",n.bind(e.getSug,this)),e.get("sugRenderer")||e.set("sugRenderer",e._getSugRenderer());var i=e.get("reset");if(i)e.addEvent(i,"click",function(){t.value="",e.hide()});e.addEvent(e.get("sug"),"click",function(t){e.emit("select",t)})},getSug:function(){var e=this,t=e._getReqHandler();t.then(function(t){e.emit("request",t),e.renderSug(t)})},_getSugRenderer:function(){function e(e,t){return e.replace(t,"<em>"+t+"</em>")}var t='<ul data-role="ul">{#list}</ul>';return function(n){var i=[],r=n.q,a=n.s;for(var o in a)i.push('<li data-key="'+a[o]+'" >'+e(a[o],r)+"</li>");return t.replace("{#list}",i.join(""))}},renderSug:function(e){var t=this,n=t.get("sugRenderer");t.get("sug").innerHTML=n(e),t.show()},_getReqHandler:function(){var e=this,n=e.get("source"),i=e.get("param"),a=e.get("input").value;n+=(n.indexOf("?")>-1?"&":"?")+i+"="+a;var o=e.get("request");if(o)return o(n);else if(e.get("jsonp"))o=t(n,{key:e.get("jsonp")});else o=r.get(n);return o},initHistory:function(){},getHistory:function(){},setHistory:function(){},clearHistory:function(){},show:function(){var e=this;if(!e.is("show"))i.show(e.get("sug")),e.addState("show"),e.emit("show");return e},hide:function(){var e=this;if(e.is("show"))i.hide(e.get("sug")),e.removeState("show"),e.emit("hide");return e}},n.inherits(e,o),require("./main").register(e),e});