define("saber-widget/LazyLoad",["require","saber-lang","saber-dom","./Widget","saber-lang/function/debounce","./main"],function(require){function t(){this.attrs={attribute:{value:"data-original"},events:{value:"scroll touchmove resize orientationchange"},animate:{value:!1},range:{value:100},placeholder:{value:["data:image/png;base64,","iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8","YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"].join("")}},this.states={complete:!1},o.apply(this,arguments)}function e(t,e,i){i=i||0;var o,a;if(e)o=r.position(t,e),a=e.getBoundingClientRect();else o=t.getBoundingClientRect(),a=n();return o.top>0?o.top-i<a.height:o.top+i>0&&o.left>0?o.left-i<a.width:o.left+i>0}function n(){var t=window,e=document,n="BackCompat"===e.compatMode?e.body:e.documentElement;return{top:0,left:0,width:t.innerWidth||n.clientWidth,height:t.innerHeight||n.clientHeight}}var i=require("saber-lang"),r=require("saber-dom"),o=require("./Widget"),a=require("saber-lang/function/debounce");return t.prototype={type:"LazyLoad",initDom:function(){if(this.container=this.get("main"),this.main=this.get("main")||document.body,this.elements=this._filterElements(),this.get("placeholder"))this.elements.forEach(function(t){t.src=this.get("placeholder")},this)},initEvent:function(){var t=this;this.get("events").split(" ").forEach(function(e){t.addEvent(t.container||window,e,t._update)}),this._update()},_filterElements:function(){return r.queryAll("["+this.get("attribute")+"]",this.main)},refresh:function(){this.elements=this._filterElements(),this.removeState("complete")},_loadElement:function(t){if(this.get("animate"))r.setStyle(t,"opacity",0),r.setStyle(t,"transition","opacity .5s linear 0s"),this.addEvent(t,"load",function(){r.setStyle(t,"opacity",1)});var e=t.getAttribute(this.get("attribute"));if("IMG"===t.tagName.toUpperCase())t.src=e;else r.setStyle(t,"background-image","url("+e+")");this.emit("load",t)},_update:a(function(){var t=this;if(this.elements=this.elements.filter(function(n){if(n)if(!n.parentNode)return!1;else if(e(n,t.container,t.get("range")))return t._loadElement(n),!1;return!0}),this.emit("change"),!this.is("complete")&&!this.elements.length)this.addState("complete"),this.emit("complete")},200)},t.isElementInViewport=e,i.inherits(t,o),require("./main").register(t),t});