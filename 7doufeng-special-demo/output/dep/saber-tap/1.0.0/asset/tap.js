define("saber-tap/tap",["require","saber-lang/bind"],function(require){"use strict";function e(){if(!("ontouchstart"in window))return!0;if(c||o&&f)return!0;else return!1}function t(e){var t=e.onclick;e.addEventListener("click",function(e){t(e)},!1),e.onclick=null}function n(n){if(this.layer=n,this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.startX=0,this.startY=0,this.lastTouchIdentifier=0,this.boundary=10,!n||!n.nodeType)throw new TypeError("layer must be a HTMLElement.");if(!e()){if(this.onClick=r(this.onClick,this),this.onMouse=r(this.onMouse,this),this.onTouchStart=r(this.onTouchStart,this),this.onTouchMove=r(this.onTouchMove,this),this.onTouchEnd=r(this.onTouchEnd,this),this.onTouchCancel=r(this.onTouchCancel,this),this.bindEvents(),!Event.prototype.stopImmediatePropagation)n.addEventListener=function(e,t,r){var i=Node.prototype.addEventListener;if("click"===e){if(!t.hijacked)t.hijacked=function(e){if(!e.propagationStopped)t(e)};i.call(n,e,t.hijacked,r)}else i.call(n,e,t,r)},n.removeEventListener=function(e,t,r){var i=Node.prototype.removeEventListener;if("click"===e)i.call(n,e,t.hijacked||t,r);else i.call(n,e,t,r)};if("function"==typeof n.onclick)t(n)}}var r=require("saber-lang/bind"),i=navigator.userAgent,o=i.indexOf("Android")>0,s=/iP(ad|hone|od)/.test(i),a=s&&/OS 4_\d(_\d)?/.test(i),u=s&&/OS ([6-9]|\d{2})_\d/.test(i),c="chrome"in window,f=i.indexOf("UCBrowser")>0;return n.prototype.bindEvents=function(){var e=this.layer;if(o)e.addEventListener("mouseover",this.onMouse,!0),e.addEventListener("mousedown",this.onMouse,!0),e.addEventListener("mouseup",this.onMouse,!0);e.addEventListener("click",this.onClick,!0),e.addEventListener("touchstart",this.onTouchStart,!1),e.addEventListener("touchmove",this.onTouchMove,!1),e.addEventListener("touchend",this.onTouchEnd,!1),e.addEventListener("touchcancel",this.onTouchCancel,!1)},n.prototype.onMouse=function(e){if(!this.targetElement)return!0;if(e.forwardedTouchEvent)return!0;if(!e.cancelable)return!0;if(!this.needsClick(this.targetElement)||this.cancelNextClick){if(e.stopImmediatePropagation)e.stopImmediatePropagation();else e.propagationStopped=!0;return e.stopPropagation(),e.preventDefault(),!1}return!0},n.prototype.getTargetElementFromEventTarget=function(e){if(e.nodeType===Node.TEXT_NODE)return e.parentNode;else return e},n.prototype.updateScrollParent=function(e){var t=e.tapScrollParent;if(!t||!t.contains(e)){var n=e;do{if(n.scrollHeight>n.offsetHeight){t=n,e.tapScrollParent=n;break}n=n.parentElement}while(n)}if(t)t.tapLastScrollTop=t.scrollTop},n.prototype.onClick=function(e){if(this.trackingClick)return this.targetElement=null,this.trackingClick=!1,!0;if("submit"===e.target.type&&0===e.detail)return!0;var t=this.onMouse(e);if(!t)this.targetElement=null;return t},n.prototype.onTouchStart=function(e){if(e.targetTouches.length>1)return!0;var t,n=this.getTargetElementFromEventTarget(e.target),r=e.targetTouches[0];if(s){if(t=window.getSelection(),t.rangeCount&&!t.isCollapsed)return!0;if(!this.isIOS4){if(r.identifier===this.lastTouchIdentifier)return e.preventDefault(),!1;this.lastTouchIdentifier=r.identifier,this.updateScrollParent(n)}}if(this.trackingClick=!0,this.trackingClickStart=e.timeStamp,this.targetElement=n,this.startX=r.pageX,this.startY=r.pageY,e.timeStamp-this.lastClickTime<200)e.preventDefault();return!0},n.prototype.touchHasMoved=function(e){var t=e.changedTouches[0],n=this.boundary;if(Math.abs(t.pageX-this.startX)>n||Math.abs(t.pageY-this.startY)>n)return!0;else return!1},n.prototype.onTouchMove=function(e){if(!this.trackingClick)return!0;var t=this.getTargetElementFromEventTarget(e.target);if(this.targetElement!==t||this.touchHasMoved(e))this.trackingClick=!1,this.targetElement=null;return!0},n.prototype.findControl=function(e){if(void 0!==e.control)return e.control;if(e.htmlFor)return document.getElementById(e.htmlFor);else return e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},n.prototype.focus=function(e){if(s&&e.setSelectionRange&&0!==e.type.indexOf("date")&&"time"!==e.type){var t=e.value.length;e.setSelectionRange(t,t)}else e.focus()},n.prototype.needsFocus=function(e){switch(e.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!o;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}},n.prototype.needsClick=function(e){switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled)return!0;break;case"input":if(s&&"file"===e.type||e.disabled)return!0;break;case"label":case"video":return!0}return/\bneedsclick\b/.test(e.className)},n.prototype.sendClick=function(e,t){if(document.activeElement&&document.activeElement!==e)document.activeElement.blur();var n=t.changedTouches[0],r=document.createEvent("MouseEvents");r.initMouseEvent(this.determineEventType(e),!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),r.forwardedTouchEvent=!0,e.dispatchEvent(r)},n.prototype.determineEventType=function(e){if(o&&"select"===e.tagName.toLowerCase())return"mousedown";else return"click"},n.prototype.onTouchEnd=function(e){var t=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.lastClickTime<200)return this.cancelNextClick=!0,!0;this.cancelNextClick=!1,this.lastClickTime=e.timeStamp;var n=this.trackingClickStart;if(this.trackingClick=!1,this.trackingClickStart=0,u){var r=e.changedTouches[0];t=document.elementFromPoint(r.pageX-window.pageXOffset,r.pageY-window.pageYOffset)||t,t.tapScrollParent=this.targetElement.tapScrollParent}var i=t.tagName.toLowerCase();if("label"===i){var c=this.findControl(t);if(c){if(this.focus(t),o)return!1;t=c}}else if(this.needsFocus(t)){if(e.timeStamp-n>100||s&&window.top!==window&&"input"===i)return this.targetElement=null,!1;if(this.focus(t),!a||"select"!==i)this.targetElement=null,e.preventDefault();return!1}if(s&&!a){var f=t.tapScrollParent;if(f&&f.tapLastScrollTop!==f.scrollTop)return!0}if(!this.needsClick(t))e.preventDefault(),this.sendClick(t,e);return!1},n.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},n.prototype.destroy=function(){var e=this.layer;if(o)e.removeEventListener("mouseover",this.onMouse,!0),e.removeEventListener("mousedown",this.onMouse,!0),e.removeEventListener("mouseup",this.onMouse,!0);e.removeEventListener("click",this.onClick,!0),e.removeEventListener("touchstart",this.onTouchStart,!1),e.removeEventListener("touchmove",this.onTouchMove,!1),e.removeEventListener("touchend",this.onTouchEnd,!1),e.removeEventListener("touchcancel",this.onTouchCancel,!1)},n.mixin=function(e){if("string"==typeof e)e=document.getElementById(e);return new n(e)},n}),define("saber-tap",["saber-tap/tap"],function(e){return e});