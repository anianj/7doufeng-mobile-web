define("saber-run/transition",["require","saber-dom","saber-promise"],function(require){function t(t,e){var n,r=t.getAttribute(l);if(r)r=parseInt(r,10),n=f[r];else r=f.length,t.setAttribute(l,r);n=n||[],n.push(e),f[r]=n}function e(t,e){var n=t.getAttribute(l);if(n){n=parseInt(n,10);var r=f[n]||[];r.some(function(t,n,r){return t===e&&r.splice(n,1)})}}function n(t){var e=t.getAttribute(l);if(e){e=parseInt(e,10);var n=f[e]||[];n.forEach(function(e){e.call(t,!0)})}}function r(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})}function i(t){if("-"!==t.charAt(0)){var e=u.style,n=r(t);if(!(n in e)){n=t.charAt(0).toUpperCase()+t.substring(1);for(var i,o=0;i=c[o];o++)if(i+n in e){t="-"+i+"-"+t;break}}}return t}var o=require("saber-dom"),s=require("saber-promise"),exports={},a=["transitionend","webkitTransitionEnd","oTransitionEnd","MSTransitionEnd","otransitionend"],u=document.createElement("div"),c=["webkit","ms","o"],f=[],l="data-transition-event";return exports.onTransitionEnd=function(e,n,r){a.forEach(function(t){e.addEventListener(t,n,r||!1)}),t(e,n)},exports.unTransitionEnd=function(t,n,r){a.forEach(function(e){t.removeEventListener(e,n,r||!1)}),e(t,n)},exports.oneTransitionEnd=function(t,e,n){var r=function(i){if(e.call(t,i)!==!1)exports.unTransitionEnd(t,r,n)};exports.onTransitionEnd(t,r,n)},exports.transition=function(t,e,n){if(!t||!e)return s.resolved(t);n=n||{},n.ease=n.ease||n.timing||"ease",n.delay=n.delay||0,n.duration=n.duration||0;var r=[],a={};Object.keys(e).forEach(function(e){a[e]=o.getStyle(t,e)}),Object.keys(e).forEach(function(n){if(a[n]!==e[n])r.push(n),o.setStyle(t,n,e[n])});var u=new s,c=function(e){var n=!0;if(e===!0||r.length<=1)u.fulfill(t),o.setStyle(t,"transition","");else r.pop(),n=!1;return n};if(r.length>0&&n.duration)exports.oneTransitionEnd(t,c),r.forEach(function(t,e){r[e]=i(t)}),o.setStyle(t,"transition-property",r.join(",")),o.setStyle(t,"transition-duration",n.duration+"s"),o.setStyle(t,"transition-timing-function",n.ease),o.setStyle(t,"transition-delay",n.delay+"s");else u.fulfill(t);return u.promise()},exports.stopTransition=function(t){o.setStyle(t,"transition-property","none"),n(t)},exports});