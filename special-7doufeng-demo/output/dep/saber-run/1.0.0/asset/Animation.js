define("saber-run/Animation",["require","saber-promise","saber-dom","saber-lang/extend","./transition"],function(require){function t(t){var e={};return t.replace(c,function(t,n,r){e[n.trim()]=r.trim()}),e}function e(t){var e=[];return Object.keys(t).forEach(function(n){e.push(n+"("+t[n]+")")}),e.join(" ")}function n(n,r){var i;return Object.keys(n).forEach(function(o){if(i=n[o],"transform"===o)n=t(r[o]||""),i=t(i),n=s(n,i),r[o]=e(n);else r[o]=i}),r}function r(t,e){this._action={},this._options={},this._defaultOptions={},this._main=t,e=e||{},this._defaultOptions.duration=e.duration||r.DURATION,this._defaultOptions.delay=e.delay||r.DELAY,this._defaultOptions.ease=u[e.ease]||u[r.EASE],this.reset(),this._promise=i.resolved(t)}var i=require("saber-promise"),o=require("saber-dom"),s=require("saber-lang/extend"),a=require("./transition"),u={"default":"ease","in":"ease-in",out:"ease-out","in-out":"ease-in-out",snap:"cubic-bezier(0,1,.5,1)",linear:"cubic-bezier(0.250, 0.250, 0.750, 0.750)","ease-in-quad":"cubic-bezier(0.550, 0.085, 0.680, 0.530)","ease-in-cubic":"cubic-bezier(0.550, 0.055, 0.675, 0.190)","ease-in-quart":"cubic-bezier(0.895, 0.030, 0.685, 0.220)","ease-in-quint":"cubic-bezier(0.755, 0.050, 0.855, 0.060)","ease-in-sine":"cubic-bezier(0.470, 0.000, 0.745, 0.715)","ease-in-expo":"cubic-bezier(0.950, 0.050, 0.795, 0.035)","ease-in-circ":"cubic-bezier(0.600, 0.040, 0.980, 0.335)","ease-in-back":"cubic-bezier(0.600, -0.280, 0.735, 0.045)","ease-out-quad":"cubic-bezier(0.250, 0.460, 0.450, 0.940)","ease-out-cubic":"cubic-bezier(0.215, 0.610, 0.355, 1.000)","ease-out-quart":"cubic-bezier(0.165, 0.840, 0.440, 1.000)","ease-out-quint":"cubic-bezier(0.230, 1.000, 0.320, 1.000)","ease-out-sine":"cubic-bezier(0.390, 0.575, 0.565, 1.000)","ease-out-expo":"cubic-bezier(0.190, 1.000, 0.220, 1.000)","ease-out-circ":"cubic-bezier(0.075, 0.820, 0.165, 1.000)","ease-out-back":"cubic-bezier(0.175, 0.885, 0.320, 1.275)","ease-in-out-quad":"cubic-bezier(0.455, 0.030, 0.515, 0.955)","ease-in-out-cubic":"cubic-bezier(0.645, 0.045, 0.355, 1.000)","ease-in-out-quart":"cubic-bezier(0.770, 0.000, 0.175, 1.000)","ease-in-out-quint":"cubic-bezier(0.860, 0.000, 0.070, 1.000)","ease-in-out-sine":"cubic-bezier(0.445, 0.050, 0.550, 0.950)","ease-in-out-expo":"cubic-bezier(1.000, 0.000, 0.000, 1.000)","ease-in-out-circ":"cubic-bezier(0.785, 0.135, 0.150, 0.860)","ease-in-out-back":"cubic-bezier(0.680, -0.550, 0.265, 1.550)"},c=/([^(]+)\(([^)]+)\)/g;return r.DURATION=.3,r.DELAY=0,r.EASE="default",r.addAction=function(t,e){var n=this.prototype;if(!n.hasOwnProperty(t))n[t]=function(){var t,n=this,r=Array.prototype.slice.call(arguments),i=e.apply(n,r)||{};return Object.keys(i).forEach(function(e){t=i[e],n.set(e,t)}),n}},r.prototype.set=function(t,e){var r={};return r[t]=e,n(r,this._action),this},r.prototype.duration=function(t){return this._options.duration=t,this},r.prototype.delay=function(t){return this._options.delay=t,this},r.prototype.ease=function(t){return this._options.ease=u[t]||u["default"],this},r.prototype.reset=function(){return this._action={},this._options=s({},this._defaultOptions),this},r.prototype.end=function(){return a.stopTransition(this._main),this},r.prototype.run=function(){var t=this._main,e=s({},this._action);if(Object.keys(e).length<=0)return this;var r=this._options;return this.reset(),this._promise=this._promise.then(function(){var i;return Object.keys(e).forEach(function(r){if(i=e[r],"function"==typeof i)i=i(t)||{},delete e[r],n(i,e)}),a.transition(t,e,r)}),this},r.prototype.finish=function(t){return this._promise.then(t),this},r.prototype.dispose=function(){this._main=null},r.addAction("moveTo",function(t,e){var n={};if(null!=t)n.left=t+"px";if(null!=e)n.top=e+"px";return n}),r.addAction("move",function(t,e){return{move:function(n){var r={},i=o.getStyle(n,"left");if(t&&i)t+=parseInt(i,10),r.left=t+"px";if(i=o.getStyle(n,"top"),e&&i)e+=parseInt(i,10),r.top=e+"px";return r}}}),r.addAction("rotateTo",function(t){return{transfor:"rotate("+t+"deg)"}}),r.addAction("rotate",function(e){return{rotate:function(n){var r=t(o.getStyle(n,"transform"));return e+=parseInt(r.rotate||"0",10),{transform:"rotate("+e+"deg)"}}}}),r.addAction("skewTo",function(t){return{transform:"skew("+t+"deg)"}}),r.addAction("skew",function(e){return{skew:function(n){var r=t(o.getStyle(n,"transform"));return e+=parseInt(r.skew||"0",10),{transform:"skew("+e+"deg)"}}}}),r.addAction("scaleTo",function(t){return{transform:"scale("+t+")"}}),r.addAction("scale",function(e){return{scale:function(n){var r=t(o.getStyle(n,"transform"));return e+=parseFloat(r.scale||"1"),{transform:"scale("+e+")"}}}}),r});