define("saber-widget/Slider",["require","exports","module","saber-lang","saber-dom","hammer","./Widget","./main"],function(require){function t(){this.attrs={animate:{value:!0},auto:{value:!0,repaint:!0},interval:{value:4e3},flex:{value:!1,repaint:!0},index:{value:0},speed:{value:300},switchAt:{value:.5},length:{readOnly:!0,getter:function(){return this.runtime.length||0}}},this.states={stop:!0},a.apply(this,arguments)}function e(t,e,n){if(e=e||"width",arguments.length>2)return i.setStyle(t,e,(parseInt(n,10)||0)+"px");else return parseInt(i.getStyle(t,e),10)||0}var n=require("saber-lang"),i=require("saber-dom"),r=require("hammer"),a=require("./Widget");return t.prototype={type:"Slider",initDom:function(){var t=this.get("main"),e=i.query("[data-role=wrapper]",t)||i.children(t)[0];if(e)i.setData(e,"role","wrapper"),i.children(e).forEach(function(t){i.setData(t,"role","item")});this.runtime.wrapper=e},initEvent:function(){var t="release touch dragleft dragright swipeleft swiperight",e=this.runtime;e.hammer=new r(e.wrapper,{dragLockToAxis:!0}).on(t,e.handler=n.bind(this._handleHammer,this)),this.on("beforedispose",function(){e.hammer.off(t,e.handler)})},repaint:function(t){if(a.prototype.repaint.call(this,t),!t)return void this._resize(!0).enable();if(t.hasOwnProperty("auto"))this[t.auto[1]?"start":"stop"](!0);if(t.hasOwnProperty("flex"))this[t.flex[1]?"enablePlugin":"disablePlugin"]("SliderFlex","flex")},enable:function(){if(this.is("disable")&&this.is("render")){this.start();var t=this.runtime.hammer;if(t)t.enable(!0);if(this.get("flex"))this.enablePlugin("SliderFlex","flex")}return a.prototype.enable.call(this),this},disable:function(){if(!this.is("disable")&&this.is("render")){this.stop();var t=this.runtime.hammer;if(t)t.enable(!1);if(this.get("flex"))this.disablePlugin("SliderFlex")}return a.prototype.disable.call(this),this},_handleHammer:function(t){var e=t.gesture,n=t.type;if("touch"!==n)e.preventDefault();var i=this.runtime,r=i.width,a=this.get("index"),o=this.get("length");switch(n){case"touch":if(i.needResume=!this.is("pause")&&!this.is("stop"),i.needResume)this.pause();break;case"dragright":case"dragleft":var s=this._percent(a),u=100/r*e.deltaX/o;if(0===a&&"right"===e.direction||a===o-1&&"left"===e.direction)u*=.4;this._move(u+s);break;case"swipeleft":if(e.stopDetect(),this.next(),i.needResume)this.resume();break;case"swiperight":if(e.stopDetect(),this.prev(),i.needResume)this.resume();break;case"release":if(Math.abs(e.deltaX)>r*this.get("switchAt"))this["right"===e.direction?"prev":"next"]();else this.to(a);if(i.needResume)this.resume()}},_percent:function(t){var e=this.get("length");return t=Math.max(0,Math.min(e-1,t)),-(100/e)*t},_resize:function(t){var n=this.runtime,r=n.width,a=e(this.get("main"));if(!t&&a===r)return this;n.width=a;for(var o=i.children(n.wrapper),s=n.length=o.length,u=0;s>u;u++)e(o[u],"width",a);return e(n.wrapper,"width",a*s),this.emit("resize",r,a),this},_loop:function(t){var e=this.runtime,i=this.get("interval");if(e.timer=clearTimeout(e.timer),!(t||!i||0>i))if(this.get("length")<2)return void this.to(0).pause();else return void(e.timer=setTimeout(n.bind(function(){var t=this.get("index")+1;this.to(t<this.get("length")?t:0),this._loop()},this),i))},_move:function(t,e){var n=this.runtime.wrapper;if(this.get("animate"))i.setStyle(n,"transition","all "+(e||0)+"ms");return i.setStyle(n,"transform","translate3d("+t+"%, 0, 0) scale3d(1, 1, 1)"),this},sync:function(){if(this.is("render"))this.pause()._resize(!0)._move(this._percent(this.get("index"))).resume();return this},start:function(t){if(this.is("stop")&&(t||this.get("auto")))this.removeState("stop"),this._loop();return this},stop:function(t){if(!this.is("stop")&&(t||this.get("auto")))this.addState("stop"),this._loop(!0);return this},pause:function(){if(!this.is("pause")&&!this.is("stop"))this.addState("pause"),this._loop(!0);return this},resume:function(){if(this.is("pause"))this.removeState("pause"),this._loop();return this},to:function(t){if(this.is("disable"))return this;var e=this.get("index");if(t=Math.max(0,Math.min(t,this.get("length")-1)),this._move(this._percent(t),this.get("speed")),e!==t)this.set("index",t),this.emit("change",e,t);return this},prev:function(){return this.to(this.get("index")-1)},next:function(){return this.to(this.get("index")+1)}},n.inherits(t,a),require("./main").register(t),t});